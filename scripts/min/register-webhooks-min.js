function getAuthenticatedRequestData(){return{_ApplicationId:Parse.applicationId,_MasterKey:Parse.masterKey,_ClientVersion:Parse.VERSION}}function getServerTriggers(){var e=getAuthenticatedRequestData();return e._method="GET",Parse._ajax("POST","https://api.parse.com/1/hooks/triggers",JSON.stringify(e)).then(function(e){return e.results.forEach(function(e){e.url&&serverHooks[e.triggerName].push(e.className)}),Parse.Promise.as()})}function getServerFunctions(){var e=getAuthenticatedRequestData();return e._method="GET",Parse._ajax("POST","https://api.parse.com/1/hooks/functions",JSON.stringify(e)).then(function(e){return e.results.forEach(function(e){e.url&&serverHooks["function"].push(e.functionName)}),Parse.Promise.as()})}function registerTriggers(e){var r=Parse.Promise.as();return Webhooks.Routes[e].forEach(function(t){var s=baseURL+"webhooks/"+e+"_"+t,n=getAuthenticatedRequestData();n.className=t,n.triggerName=e,n.url=s;var o="https://api.parse.com/1/hooks/triggers";serverHooks[e].indexOf(t)>=0&&(n._method="PUT",o+="/"+t+"/"+e),r=r.then(function(){return Parse._ajax("POST",o,JSON.stringify(n)).then(function(r){return console.log("Registered "+e+" for: "+t),Parse.Promise.as()},function(e){return console.log(e.responseText),Parse.Promise.as()})})}),r}function registerBeforeSaves(){return registerTriggers("beforeSave")}function registerAfterSaves(){return registerTriggers("afterSave")}function registerBeforeDeletes(){return registerTriggers("beforeDelete")}function registerAfterDeletes(){return registerTriggers("afterDelete")}function registerFunctions(){var e=Parse.Promise.as();return Webhooks.Routes["function"].forEach(function(r){var t=baseURL+"webhooks/function_"+r,s=getAuthenticatedRequestData();s.functionName=r,s.url=t;var n="https://api.parse.com/1/hooks/functions";serverHooks["function"].indexOf(r)>=0&&(s._method="PUT",n+="/"+r),e=e.then(function(){Parse._ajax("POST",n,JSON.stringify(s)).then(function(e){return console.log("Registered function for: "+r),Parse.Promise.as()},function(e){return console.log(e.responseText),Parse.Promise.as()})})}),e}process.env.HOOKS_URL&&process.env.PARSE_APP_ID&&process.env.PARSE_MASTER_KEY||(console.log("*** WARNING *** Could not register hooks, environment variables are not set!"),process.exit(0));var Webhooks=require("parse-cloud-express"),Parse=require("parse/node").Parse;require("../cloud/main.js");var baseURL=process.env.HOOKS_URL,serverHooks={beforeSave:[],afterSave:[],beforeDelete:[],afterDelete:[],"function":[]};Parse.initialize(process.env.PARSE_APP_ID,"unused",process.env.PARSE_MASTER_KEY),getServerTriggers().then(getServerFunctions).then(registerBeforeSaves).then(registerAfterSaves).then(registerBeforeDeletes).then(registerAfterDeletes).then(registerFunctions).then(function(){console.log("Hooks registration completed.")});