function getDailyFreq(){var e=0;return e=Number($("#daily-freq").val()),(e>10||1>e)&&(e=0),e}function getWeeklyFreq(){var e=[];return $(".weekly-freq.active").each(function(){e.push(this.textContent.trim().toLowerCase())}),e}function createFileFromUpload(){var e,t=$("#icon-upload-input")[0];if(t.files.length>0){var i=t.files[0],n="photo.jpg";e=new Parse.File(n,i)}return e}function getNotificationTimes(){var e=[];return $(".notification-input-time").each(function(){-1===e.indexOf(this.textContent)&&e.push(this.textContent)}),e}function validateForm(e,t,i,n){UTILS.log("Attempting to add/save habit"),UTILS.log("Title Length: "+e),UTILS.log("Icon: "+t),UTILS.log("Weekly Freq: "+i),UTILS.log("Daily Freq: "+n);var o=!1;return e?$(".add-title-error").hide():($(".add-title-error").show(),o=!0),t&&t._source&&t._source.file.size>MAX_FILE_SIZE?($(".add-icon-error").text(INVALID_FILE_SIZE),$(".add-icon-error").show(),o=!0):$(".add-icon-error").hide(),i.length?$(".add-weekly-error").hide():($(".add-weekly-error").show(),o=!0),n?$(".add-daily-error").hide():($(".add-daily-error").show(),o=!0),o?($(".forms-required").css("visibility","visible"),!1):($(".forms-required").css("visibility","hidden"),!0)}function appendNotificationTime(e,t){var e=e||$("#notification-input").val(),t=t||$("#notification-input-ampm").val(),i=$('<div class="notification-option-wrapper"></div>'),n=$('<div class="notification-left"></div>'),o=$('<p class="notification-input-time">'+e+t+"</p>"),r=$('<div class="notification-right"></div>'),a=$('<button class="notification-delete-btn"> - </button>');n.append(o),r.append(a),i.append(n),i.append(r),$("#notification-container").prepend(i)}function populateEditForm(){var e=Parse.Object.extend("HabitToEdit"),t=new Parse.Query(e);t.include("habit"),t.equalTo("userId",Parse.User.current().id),t.first({success:function(e){var t=e.get("habit"),i=t.get("dayOfWeek");$("#title").val(t.get("name")),$("#daily-freq").val(t.get("timesPerDay")),t.get("img")&&$("#icon").attr("src",t.get("img").url()),i.forEach(function(e){$(".weekly-freq-"+e.toLowerCase()).addClass("active")}),$(".hidden-habit-id").attr("id",t.id);var n=Parse.Object.extend("Notification"),o=new Parse.Query(n);o.equalTo("habit",t),o.find({success:function(e){for(var t=0,i=e.length;i>t;t++)appendNotificationTime(e[t].get("time").slice(0,-2),e[t].get("time").slice(-2))},error:function(e){UTILS.log("Error: "+e.code+" "+e.message)}})},error:function(e){UTILS.log("Error: "+e.code+" "+e.message)}})}function bindEventListeners(){$("#notification-add-btn").on("click",function(e){e.preventDefault(),appendNotificationTime()}),$(document).on("click",".notification-delete-btn",function(e){e.preventDefault();var t=$(this).closest(".notification-option-wrapper");$(t).remove()}),$("#icon-upload-btn").on("click",function(){UTILS.log("Uploading an image"),$("#icon-upload-input").click()}),$("#icon-upload-input").on("change",function(){var e=this.files;if(UTILS.log(e),!e||!e[0].type.match("image.*"))return $(".add-icon-error").text(INVALID_FILE_FORMAT),void $(".add-icon-error").show();if("undefined"!=typeof FileReader){var t=new FileReader;t.onload=function(e){$("#icon").attr("src",e.target.result)},t.readAsDataURL(this.files[0])}}),$("#weekly-container .weekly-freq").on("click",function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active")}),$("#daily-container .daily-freq").on("click",function(){var e=$(".daily-freq.active");return $(this).hasClass("active")?void e.removeClass("active"):(e.removeClass("active"),void $(this).addClass("active"))}),$(".icon-wrapper").on("click",function(){var e=$(".icon.active"),t=$(this).find(".icon");return t.hasClass("active")?void e.removeClass("active"):(e.removeClass("active"),void t.addClass("active"))}),$("#add-habit-btn").on("click",function(){location.href="add.html"}),$("#save-habit-button").on("click",function(e){function t(e){var t=Parse.Object.extend("Habit"),r=new t;r.save({userId:Parse.User.current().id,name:i,img:e,dayOfWeek:n,timesPerDay:o,doneToday:0,bestRecord:0,currentRecord:0},{success:function(e){var t=getNotificationTimes();if(t.length){for(var i=Parse.Object.extend("Notification"),n=[],o=0,r=t.length;r>o;o++){var a=new i;a.set("habit",e),a.set("time",t[o]),a.set("playerId",oneSignalPlayerId),n.push(a)}Parse.Object.saveAll(n,{success:function(e){location.href="list.html"},error:function(e){UTILS.log("Error:"+e.code+" "+e.message)}})}else location.href="list.html"},error:function(e){UTILS.log("Error: "+e.code+" "+e.message)}})}e.preventDefault();var i=$("#title").val().trim();i&&i.replace(/^./,i[0].toUpperCase());var n=getWeeklyFreq(),o=getDailyFreq(),r=createFileFromUpload(),a=$("#title").val()?$("#title").val().trim().length:0;validateForm(a,r,n,o)&&(r&&r._source.file.type.match("image.*")?r.save().then(function(e){t(e)},function c(){UTILS.log("Could not save file")}):t())}),$("#edit-save-button").on("click",function(e){function t(e){var t=Parse.Object.extend("Habit"),r=new Parse.Query(t);r.equalTo("objectId",c.attr("id")),r.first({success:function(t){t.save({name:i,dayOfWeek:n,timesPerDay:o,img:e});var r=Parse.Object.extend("Notification"),a=new Parse.Query(r);a.equalTo("habit",t),a.find({success:function(e){for(var i=0,n=e.length;n>i;i++)e[i].destroy();var o=getNotificationTimes();if(o.length){for(var r=Parse.Object.extend("Notification"),a=[],i=0,n=o.length;n>i;i++){var c=new r;c.set("habit",t),c.set("time",o[i]),c.set("playerId",oneSignalPlayerId),console.log("Pushing Notification..."),a.push(c)}Parse.Object.saveAll(a,{success:function(e){location.href="list.html"},error:function(e){UTILS.log("Error:"+e.code+" "+e.message)}})}else location.href="list.html"},error:function(e){UTILS.log("Error:"+e.code+" "+e.message)}})},error:function(e){UTILS.log("Error:"+e.code+" "+e.message)}})}UTILS.log("ATTEMPTING TO SAVE AN EDITED HABIT"),e.preventDefault();var i=$("#title").val().trim();i&&i.replace(/^./,i[0].toUpperCase());var n=getWeeklyFreq(),o=getDailyFreq(),r=createFileFromUpload(),a=i.length,c=$(".hidden-habit-id");validateForm(a,r,n,o)&&(r&&r._source.file.type.match("image.*")?r.save().then(function(e){t(e)},function s(s){UTILS.log("Error: "+s.code+" "+s.message)}):t())}),$(document).on("click",".op-edit",function(){UTILS.log("ATTEMTPING TO EDIT HABIT");var e=$(this).closest(".habit-element"),t=e.attr("id"),i=Parse.Object.extend("Habit"),n=new Parse.Query(i);n.equalTo("objectId",t),n.first({success:function(e){var t=Parse.Object.extend("HabitToEdit"),i=new Parse.Query(t);i.equalTo("userId",Parse.User.current().id),i.first({success:function(i){if(i)i.save({habit:e},{success:function(){location.href="edit.html"},error:function(e){UTILS.log("Error: "+e.code+" "+e.message)}});else{var n=new t;n.save({habit:e,userId:Parse.User.current().id},{success:function(e){location.href="edit.html"},error:function(e){UTILS.log("Error: "+e.code+" "+e.message)}})}},error:function(e){UTILS.log("Error: "+e.code+" "+e.message)}})},error:function(e){UTILS.log("Error: "+e.code+" "+e.message)}})}),$(document).on("click",".op-done:not(.disabled)",function(){var e=$(this).closest(".habit-element"),t=e.attr("id"),i=e.find(".times-done-today")[0],n=e.find(".times-per-day")[0],o=e.find(".current-record")[0],r=e.find(".best-record")[0],a=Number(i.textContent),c=Number(n.textContent);if(c>a){var s=Parse.Object.extend("Habit"),l=new Parse.Query(s),d=!1,u=!1,f=Number(o.textContent),v=Number(r.textContent),m=e.find(".status-bar")[0];a++;var g=a/c*100;i.textContent=a,$(m).animate({width:g+"%"},200),a===c&&(f++,o.textContent=f,d=!0,f>v&&(v++,r.textContent=v,u=!0)),l.equalTo("objectId",t),l.first({success:function(e){d&&e.increment("currentRecord"),u&&e.increment("bestRecord"),e.increment("doneToday"),e.save()},error:function(e){UTILS.log("Error: "+e.code+" "+e.message)}})}}),$(document).keyup(function(e){27===e.keyCode&&$("#delete-cancel").click()}),$(document).on("click",".op-del",function(){UTILS.log("ATTEMPTING TO DELETE A HABIT");var e=$(this).closest(".habit-element"),t=e.attr("id");$("#mask").addClass("mask-filter"),$("#confirm-delete").show(),$("#delete-cancel, #delete-final").on("click",function(){$("#mask").removeClass("mask-filter"),$("#confirm-delete").hide()}),$("#delete-cancel").on("click",function(){e=null}),$("#delete-final").on("click",function(){function i(e){var t=Parse.Object.extend("Notification"),i=new Parse.Query(t);i.equalTo("habit",e),i.find({success:function(e){for(var t=0,i=e.length;i>t;t++)e[t].destroy()},error:function(e){UTILS.log("Error: "+e.code+" "+e.message)}})}if(null!==e){e.animate({opacity:"0"},250,function(){$(this).slideUp(350,function(){$(this).hide()})});var n=Parse.Object.extend("Habit"),o=new Parse.Query(n);o.equalTo("objectId",t),o.first({success:function(e){i(e),e&&e.destroy({success:function(e){},error:function(e){UTILS.log("Error: "+e.code+" "+e.message)}})},error:function(e){UTILS.log("Error: "+e.code+" "+e.message)}})}})})}const INVALID_FILE_FORMAT="invalid file format",REQUIRED="required",INVALID_FILE_SIZE="max 2MB",MAX_FILE_SIZE=2097152;var oneSignalPlayerId,UTILS={debug:!0,log:function(e,t){UTILS.debug&&(t=t?t:"",console.log(e))}};$(document).on("ready",function(){Parse.initialize("hIP8KstprKjGsmE4VVHT86i2m1VobE8Mc0x7pBi6","ixAsSo9S7uCHLCKqdfKhUt1ZNcOBGX129Toy8QyO"),$("#current-user").html(Parse.User.current().get("email")),OneSignal.push(["getIdsAvailable",function(e){oneSignalPlayerId=e.userId}]),"edit-page"===$("body").attr("id")&&populateEditForm(),bindEventListeners()});